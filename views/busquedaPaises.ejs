<div class="container">
     <h1>Buscar Pais</h1>

   <form id="form-busqueda" class="search-form">
    <div class="form-group">
        <label for="atributo">Buscar por:</label>
        <select id="atributo" name="atributo" required>
            <option value="nombre">Nombre</option>
            <option value="capital">Capital</option>
            <option value="fronteras">Fronteras</option>

            <option value="area">Área</option>
            <option value="poblacion">Población</option>
                    
        </select>
    </div>
    <div class="form-group">
        <label for="valor">Valor:</label>
        <input type="text" id="valor" name="valor" required>
    </div>
    <button type="submit" class="btn btn-primary">Buscar</button>
</form>

<script>
document.getElementById('form-busqueda').addEventListener('submit', function(e) {
    e.preventDefault(); // Evitar que envíe por defecto
    const atributo = document.getElementById('atributo').value;
    const valor = document.getElementById('valor').value.trim();
    if (atributo && valor) {
        window.location.href = `/pais/buscar/${encodeURIComponent(atributo)}/${encodeURIComponent(valor)}`;
    }
});
</script>

    <h1>Lista de Países</h1>

    <% if (paises && paises.length > 0) { %>
        
        <!-- Tabla -->
        <table class="table-custom">
            <thead >
                <tr>
                    <th>Nombre</th>
                    <th>Capital</th>
                    <th>Área</th>
                    <th>Fronteras</th>
                    <th>Población</th>
                    <th>TimeZones</th>
                    <th>Bandera</th>
                    <th>Creador</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="paisesTableBody">
                <% paises.forEach((pais) => { %>
                    <tr class="pais-row"
                        data-area="<%= Number(pais.area) || 0 %>"
                        data-poblacion="<%= Number(pais.poblacion) || 0 %>">
                    <td><%= pais.nombre %></td>
                    <td><%= pais.capital || 'N/A' %></td>
                    <td><%= pais.area || 'N/A' %></td>
                    <td><%= pais.fronteras?.length ? pais.fronteras.join(', ') : 'N/A' %></td>
                    <td><%= pais.poblacion || 'N/A' %></td>
                    <td><%= pais.timezones?.length ? pais.timezones.join(', ') : 'N/A' %></td>
                    <td>
                        <% if (pais.bandera) { %>
                        <img src="<%= pais.bandera %>" alt="Bandera de <%= pais.nombre %>" style="width:50px; border:1px solid #ccc;">
                        <% } else { %> N/A <% } %>
                    </td>
                    <td><%= pais.creador || 'N/A' %></td>
                    <td>
                        <a href="/formEditarPais/<%= pais.id %>" class="btn btn-primary btn-sm">Actualizar</a>
                        <a href="/confirmarEliminar/<%= pais.id %>" class="btn btn-danger btn-sm">Eliminar</a>
                    </td>
                    </tr>
                <% }); %>
                </tbody>
            <tfoot>
                <tr class="table-info">
                    <td colspan="2"><strong>Subtotales (página):</strong></td>
                    <td id="subtotalArea"></td>
                    <td>—</td>
                    <td id="subtotalPoblacion"></td>
                    <td colspan="4"><strong>Países en página:</strong> <span id="subtotalPaises"></span></td>
                </tr>
                </tfoot>
        </table>

            <!-- Selector de filas -->
            <div class="rows-selector">
            <label for="rowsPerPage">Filas por página:</label>
            <select id="rowsPerPage">
                <option value="5" >5</option>
                <option value="10" >10</option>
                <option value="20">20</option>
                <option value="50" >50</option>
            </select>
            </div>
        <!-- Paginación -->
       <!-- Paginación (Frontend, controlada por JS) -->
        <div class="pagination">
          <button id="prevPage">Anterior</button>
          <span id="pageInfo"></span>
          <button id="nextPage">Siguiente</button>
        </div>


    <% } else { %>
        <p class="message">No hay País registrados aún.</p>
    <% } %>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
  const rows = Array.from(document.querySelectorAll(".pais-row"));
  const rowsPerPageSelect = document.getElementById("rowsPerPage");
  const prevBtn = document.getElementById("prevPage");
  const nextBtn = document.getElementById("nextPage");
  const pageInfo = document.getElementById("pageInfo");

  const subtotalAreaEl = document.getElementById("subtotalArea");
  const subtotalPoblacionEl = document.getElementById("subtotalPoblacion");
  const subtotalPaisesEl = document.getElementById("subtotalPaises");

  let currentPage = 1;
  let rowsPerPage = parseInt(rowsPerPageSelect.value);

  function updateSubtotals() {
    let area = 0, poblacion = 0, count = 0;
    rows.forEach(row => {
      if (row.style.display !== "none") {
        area += Number(row.dataset.area) || 0;
        poblacion += Number(row.dataset.poblacion) || 0;
        count++;
      }
    });
    subtotalAreaEl.textContent = area;
    subtotalPoblacionEl.textContent = poblacion;
    subtotalPaisesEl.textContent = count;
  }

  function showPage(page) {
    const totalPages = Math.ceil(rows.length / rowsPerPage);
    currentPage = Math.min(Math.max(1, page), totalPages);

    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    rows.forEach((row, i) => {
      row.style.display = (i >= start && i < end) ? "" : "none";
    });

    pageInfo.textContent = `Página ${currentPage} de ${totalPages} total de paises: ${rows.length}`;
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;

    updateSubtotals();
  }

  rowsPerPageSelect.addEventListener("change", () => {
    rowsPerPage = parseInt(rowsPerPageSelect.value);
    showPage(1); // reiniciar a la primera página
  });

  prevBtn.addEventListener("click", () => showPage(currentPage - 1));
  nextBtn.addEventListener("click", () => showPage(currentPage + 1));

  // Inicializar
  showPage(currentPage);
});
</script>
